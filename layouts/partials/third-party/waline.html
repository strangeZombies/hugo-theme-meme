{{- $src := partial "utils/lib.html" (dict "$" . "type" "waline") -}}
<link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css">

<script>
    function loadComments() {
        if (!document.getElementById('Waline-container')) {
            return;
        }
        if (typeof Waline === 'undefined') {
            const getScript = (options) => {
                const script = document.createElement('script');
                script.defer = true;
                script.crossOrigin = 'anonymous';
                Object.keys(options).forEach((key) => {
                    script[key] = options[key];
                });
                document.body.appendChild(script);
            };
            getScript({
                src: '{{ $src }}',
                onload: () => {
                    newWaline();
                }
            });
        } else {
            newWaline();
        }
    }
    function newWaline() {
        const Waline = new Waline({
            clientID: {{ .Site.Params.WalineClientID }},
            clientSecret: {{ .Site.Params.WalineClientSecret }},
            repo: {{ .Site.Params.WalineRepo }},
            owner: {{ .Site.Params.WalineOwner }},
            admin: {{ .Site.Params.WalineAdmin }},

        {{ if eq .Site.Params.WalineID "pathname" }}
            id: location.pathname,
        {{ else if eq .Site.Params.WalineID "hash" }}
            id: {{ .File.UniqueID }},
        {{ else if hasPrefix .Site.Params.WalineID "custom:" }}
            id: {{ strings.TrimPrefix "custom:" .Site.Params.WalineID }},
        {{ end }}

            number: {{ .Site.Params.WalineNumber }},
            labels: {{ .Site.Params.WalineLables }},

        {{ if hasPrefix .Site.Params.WalineTitle "custom:" }}
            title: {{ strings.TrimPrefix "custom:" .Site.Params.WalineTitle }},
        {{ end }}

        {{ if eq .Site.Params.WalineBody "href" }}
            body: location.href,
        {{ else if hasPrefix .Site.Params.WalineBody "custom:" }}
            body: {{ strings.TrimPrefix "custom:" .Site.Params.WalineBody }},
        {{ end }}

        {{ if ne .Site.Params.WalineLanguage "default" }}
            language: {{ .Site.Params.WalineLanguage }},
        {{ end }}

            perPage: {{ .Site.Params.WalinePerPage }},
            distractionFreeMode: {{ .Site.Params.WalineDistractionFreeMode }},
            pagerDirection: {{ .Site.Params.WalinePagerDirection }},
            createIssueManually: {{ .Site.Params.WalineCreateIssueManually }},
            proxy: {{ .Site.Params.WalineProxy }},
            flipMoveOptions: {
                staggerDelayBy: {{ .Site.Params.WalineStaggerDelayBy }},
                appearAnimation: {{ .Site.Params.WalineAppearAnimation }},
                enterAnimation: {{ .Site.Params.WalineEnterAnimation }},
                leaveAnimation: {{ .Site.Params.WalineLeaveAnimation }}
            },
            enableHotKey: {{ .Site.Params.WalineEnableHotKey }}
        })

        Waline.render('Waline-container')
    }
</script>

